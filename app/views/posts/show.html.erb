<p onload="call()" style="color: green"><%= notice %></p>
  <%if @post.post_profile.attached?%>
    <%= image_tag @post.post_profile ,style: "width:20%;border:1px solid black;padding:5px;"%>
  <%else%>
    <div style="width:20rem;height:7rem;background-color:gray;"></div>
  <%end%>
  <p>
    <strong>Name:</strong>
    <%= @post.name %>
  </p>

  <p>
    <strong>Description:</strong>
    <%= @post.description %>
  </p>

<div>
  <% if can? :update, @post%>
    <%= link_to "Edit this Post", edit_topic_post_path(@topic,@post) %> |
  <%end%>
  <%= link_to "Back", topic_posts_path(@topic) %> |
  <%= link_to "List all posts", posts_path %>
  <% if can? :destroy, @post%>
    <%= button_to "Destroy this post", topic_post_path(@topic,@post), method: :delete %>
  <%end%>
</div>


----------------------------------------------------------------------------------------------

<h3>Ratings <span><%= @post.ratings.average(:no).to_f.truncate(1) %></span></h3>
<div >
  <%= form_with(model: [@topic,@post,@star],:html=>{:style=>"display:flex;gap:1rem;"}) do |form|%>

    <div>
      <%=form.radio_button :star,1 %>
      <%=form.label :star, "1 star"%>
    </div>

    <div>
      <%=form.radio_button :star,2%>
      <%=form.label :star, "2 star"%>
    </div>

    <div>
      <%=form.radio_button :star,3%>
      <%=form.label :star, "3 star"%>
    </div>

    <div>
      <%=form.radio_button :star,4%>
      <%=form.label :star, "4 star"%>
    </div>

    <div>
      <%=form.radio_button :star,5%>
      <%=form.label :star, "5 star"%>
    </div>

    <div>
      <%= form.submit "Add"%>
    </div>

  <%end%>
</div>

<%if !@rating.nil? && @rating.count>0%>
  <table>
    <thead>
      <th>Rate</th>
      <th>Count</th>
    </thead>
    <tbody>
      <%@rating.keys.reverse.each do |rating|%>
        <tr>
          <td><%= rating %> Star</td>
          <td><%= @rating[rating] %></td>
        </tr>
      <%end%>
    </tbody>
  </table>
<%end%>
----------------------------------------------------------------------------------------------

<h3>Tags</h3>

<%if @tag.count>0%>
  <table>
    <thead>
      <tr>
        <th>Tag</th>
        <% if can? :destroy, @post%>
          <th>Operations</th>
        <%end%>
      </tr>
    </thead>
    <tbody>
      <%@tag.each do |tag| %>
        <tr>
          <td><%= tag.name%></td>
          <% if can? :destroy, @post%>
          `<td><%= button_to "remove",  topic_post_tag_path(@topic,@post,tag),method: :delete %></td>
          <%end%>
        </tr>
      <%end%>
    </tbody>  
  </table>
<%else%>
  <p>Empty Tags</p>
<%end%>


---------------------------------------------------------------------------------------------------

<h3>Comments</h3>

<div>
  <%= link_to "Add comment", new_topic_post_comment_path(@topic,@post) %>
</div>

<%if @comment.count>0%>
  <table>
    <thead>
      <tr>
        <th>Message</th>
        <th>Author Name</th>
        <th colspan="3">Operations</th>
      </tr>
    </thead>
    <tbody>
      <%@comment.each do |comment| %>
        <tr>
          <td><%= comment.msg%></td>
          <td><%= User.find(comment.user_id).email%></td>

          <td><%= link_to "show", topic_post_comment_path(@topic,@post,comment)%></td>
          
          <% if can? :update, comment%>
            <td><%= link_to "Edit", edit_topic_post_comment_path(@topic,@post,comment)%></td>
          <%end%>

          <% if can? :destroy, comment%>
            <td><%= button_to "Delete", topic_post_comment_path(@topic,@post,comment),method: :delete %></td>
          <%end%>
        </tr>
      <%end%>
    </tbody>  
  </table>
<%else%>
  <p>Empty comments</p>
<%end%>

<script>
    console.log("<%=current_user.id%>")
    console.log("<%= topic_post_path%>/read/<%=current_user.id%>")
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST","<%= topic_post_path%>/read/<%=current_user.id%>");
    xhttp.send();
</script>


